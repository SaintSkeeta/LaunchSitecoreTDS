---
ID: "af857d1b-c76b-43ba-a092-9b33744d8ac0"
Parent: "ec38ebb3-f2e8-493d-b0e6-b8c68c9afb85"
Template: "d9019e30-f954-46cc-aa70-3e928c40b5d0"
Path: "/sitecore/content/Home/About-Launch-Sitecore/Building-the-Site/Accessing-Current-Visitor-Information"
DB: master
SharedFields:
- ID: "b0a67b2a-8b07-4e0b-8809-69f751709806"
  Hint: __Tracking
  Value: |
    <tracking>
      <profile id="{3CEA9A30-CFA9-42F4-BA09-9100BFB1FAC5}" name="Audience Segment" presets="developer|100||">
        <key name="Analytics" value="1" />
        <key name="Campaigns and Targeting" value="1" />
        <key name="Content Management" value="4" />
        <key name="Technology" value="5" />
      </profile>
    </tracking>
- ID: "1172f251-dad4-4efb-a329-0c63500e4f1e"
  Hint: __Masters
  Value: "{1B6A3702-5694-4FC4-8366-989ECDCD7F1B}"
- ID: "a4f985d9-98b3-4b52-aaaf-4344f6e747c6"
  Hint: __Workflow
  Value: "{E3FBD307-EC4A-4377-BFEB-F732CD5CAF5A}"
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "234542dc-c610-4ca8-baa6-2592a8bcb1d7"
      Hint: Title
      Value: Accessing Current Visitor Information
    - ID: "00e1d306-96bd-4b32-85b4-cd63c53cc6c1"
      Hint: Abstract
      Value: <p>The Sitecore Analytics API gives you full access to the information about the current web site visitor. </p>
    - ID: "5a5684bb-8b54-44f6-abcc-2bada05ada5d"
      Hint: Body
      Value: |
        <p>In order to access Visitor data in the Engagement Analytics API, you primarily use the following classes:</p>
        <ul>
            <li>Sitecore.Analytics.Tracker </li>
            <li>Sitecore.Analytics.TrackerDataContext </li>
        </ul>
        <p>The following namespace <em>using</em> directives will be helpful when accessing this data.</p>
        <ul>
            <li style="list-style-type: none;"><em>using Sitecore.Analytics;</em> </li>
            <li style="list-style-type: none;"><em>using Sitecore.Analytics.DataAccess;</em> </li>
            <li style="list-style-type: none;"><em>using Sitecore.Analytics.DataAccess.DataSets;</em> </li>
        </ul>
        <h3>How to Access GeoIP Data</h3>
        <p>The <em>Sitecore.Analytics.Tracker</em> is a static class that is used to track each visitor. It provides access to the Analytics context, exposing the visitors IP address, country, city, zip code, latitude, longitude and more. The follow example demonstrates how to access the current visitors IP address.</p>
        <pre class="prettyprint linenums"><ol class="linenums"><li>using Sitecore.Analytics;</li><li>using Sitecore.Analytics.DataAccess;</li><li>using Sitecore.Analytics.DataAccess.DataSets;</li><li></li><li>public class GeoIPTracker : Sitecore.Web.UI.WebControl</li><li>{</li><li> protected override void DoRender(System.Web.UI.HtmlTextWriter output)</li><li> {</li><li>  string ip = new IPAddress(Tracker.CurrentVisit.Ip).ToString();</li><li>  if (Tracker.CurrentVisit == null)</li><li>   return;</li><li></li><li>  if (!Tracker.CurrentVisit.UpdateGeoIpData())</li><li>   output.Write("GeoIP information not " + "available within prescribed time.&lt;br/&gt;");</li><li>  else if (Tracker.CurrentVisit.BusinessName == "IP_NOT_FOUND" || Tracker.CurrentVisit.BusinessName == "N/A")</li><li>   output.Write("GeoIP information not avaialble for " + ip + ".&lt;br/&gt;");</li><li>  else if (String.IsNullOrEmpty(Tracker.CurrentVisit.BusinessName))</li><li>   output.Write("No business name in GeoIP data for " + ip + " (error contacting provider).&lt;br/&gt;");</li><li>  else</li><li>   output.Write("Business name from GeoIP record: " + Tracker.CurrentVisit.BusinessName + ".&lt;br/&gt;");</li><li> }</li><li>}</li></ol></pre>
        <h3>How to Access Session Data</h3>
        <p>Beyond Geo IP data, Sitecore stores valuable session data that is accessible via the Analytics API. The following code demonstrates how to access information about any search engine keywords that are associated with the Visitor's current session or previous 10 sessions, if any:</p>
        <pre class="prettyprint linenums"><ol class="linenums"><li>using Sitecore.Analytics;</li><li>using Sitecore.Analytics.Data.DataAccess;</li><li>using Sitecore.Analytics.Data.DataAccess.DataSets;</li><li></li><li>public class ExampleTracker : Sitecore.Web.UI.WebControl</li><li>{</li><li> protected override void DoRender(System.Web.UI.HtmlTextWriter output)</li><li> {</li><li>  if (Tracker.CurrentVisit == null)</li><li>   return;</li><li>  if (Tracker.CurrentVisit.Keywords != null &amp;&amp; !String.IsNullOrEmpty(Tracker.CurrentVisit.Keywords.Text))</li><li>  {</li><li>   output.WriteLine("Search keywords for current visit: " + Tracker.CurrentVisit.Keywords.Text + ".&lt;br/&gt;");</li><li>   return;</li><li>  }</li><li></li><li>  const int checkVisits = 10;</li><li>  Sitecore.Analytics.Data.DataAccess.VisitorLoadOptions vOptions = new Sitecore.Analytics.Data.DataAccess.VisitorLoadOptions</li><li>  {</li><li>   Start = Tracker.CurrentVisit.VisitorVisitIndex - 1,</li><li>   Count = Tracker.CurrentVisit.VisitorVisitIndex - checkVisits,</li><li>   VisitLoadOptions = VisitLoadOptions.Visits</li><li>  };</li><li></li><li>  foreach (VisitorDataSet.VisitsRow visit in Tracker.Visitor.GetVisits(vOptions)</li><li>   .Where(visit =&gt; visit.VisitId != Tracker.CurrentVisit.VisitId).OrderByDescending(visit =&gt; visit.VisitorVisitIndex))</li><li>  {</li><li>   if (visit.Keywords != null &amp;&amp; !String.IsNullOrEmpty(visit.Keywords.Text))</li><li>   {</li><li>    output.WriteLine("Last search keywords from " + visit.StartDateTime + " visit: " + visit.Keywords.Text + "&lt;br/&gt;");</li><li>    return;</li><li>   }</li><li>  }</li><li>  output.WriteLine("No search keywords for current or last " + checkVisits + " visits.&lt;br/&gt;");</li><li> }</li><li>}</li></ol></pre>
        <p><br />
        </p>
        <div class="code">
        <div style="background-color: #dddddd; overflow: auto;">
        <ol style="padding: 0px 0px 0px 5px; margin: 0px 0px 0px 2.5em; background-color: #ffffff;">
        </ol>
        </div>
        </div>
    - ID: "2b60d8c1-81db-45a7-b1cb-654cdda96ae3"
      Hint: Icon
      Value: |
        <image mediaid="{27F2AB1B-0C2D-4E1E-9AA4-70CCE0B76454}" mediapath="/Launch Sitecore/Site Images/Icons/Monochrome/c-f/contract" src="~/media/27f2ab1b0c2d4e1e9aa470cce0b76454.ashx" />
    - ID: "82d725ed-6707-4532-86a6-5444e34332fd"
      Hint: Contributors
      Value: "{EF5350C8-21BF-43A3-BCEF-71F29D91AEF0}"
    - ID: "d7229dba-b952-4d82-a5a0-459c69618d45"
      Hint: Menu Title
      Value: Accessing Current Visitor Information
    - ID: "b5e02ad9-d56f-4c41-a065-a133db87bdeb"
      Hint: __Display name
      Value: Accessing Current Visitor Information
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20110713T085500
    - ID: "8cdc337e-a112-42fb-bbb4-4143751e123f"
      Hint: __Revision
      Value: "c0cf8f80-8f0f-48b2-92f4-7573628cee92"
    - ID: "d9cf14b1-fa16-4ba6-9288-e8a174d4d522"
      Hint: __Updated
      Value: "20131218T152055:635229768553692565"
    - ID: "badd9cf9-53e0-4d0c-bcc0-2d784c282f6a"
      Hint: __Updated by
      Value: |
        sitecore\admin
    - ID: "3e431de1-525e-47a3-b6b0-1ccbec3a8c98"
      Hint: __Workflow state
      Value: "{3E42AE7F-CB44-415C-91D2-B16E9E1ECB5A}"
    - ID: "001dd393-96c5-490b-924a-b0f25cd9efd8"
      Hint: __Lock
      Value: <r />
